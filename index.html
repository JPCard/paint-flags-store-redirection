<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="Play Paint Flags!">
    <meta property="og:description" content="Join me in the best country flag game.">
    <meta property="og:image" content="https://raw.githubusercontent.com/jpcard/paint-flags-store-redirection/main/images/paint_flags_preview_banner.jpg">
    <meta property="og:url" content="https://jpcard.github.io/paint-flags-store-redirection/">
    <meta property="og:type" content="website">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Play Paint Flags!">
    <meta name="twitter:description" content="Join me in the best country flag game.">
    <meta name="twitter:image" content="https://raw.githubusercontent.com/jpcard/paint-flags-store-redirection/main/images/paint_flags_preview_banner.jpg">
    
    <script>
		const PLAY_STORE_LINK = "https://play.google.com/store/apps/details?id=com.coastcitygames.flags";
		const DEFAULT_UTM_SOURCE = "direct_sharing";
		const DEFAULT_UTM_MEDIUM = "share_link";
		const DEFAULT_UTM_CAMPAING = "self_promotion";

		function getQueryParams() {
			let params = new URLSearchParams(window.location.search);
			return {
				utm_source: params.get('utm_source'),
				utm_medium: params.get('utm_medium'),
				utm_campaign: params.get('utm_campaign')
			};
		}

		function buildPlayStoreLink(params) {
			let url = new URL(PLAY_STORE_LINK);
			let utm_source = params.utm_source? params.utm_source:DEFAULT_UTM_SOURCE;
			let utm_medium = params.utm_medium? params.utm_medium:DEFAULT_UTM_MEDIUM;
			let utm_campaign = params.utm_campaign? params.utm_campaign:DEFAULT_UTM_CAMPAING;
			url.searchParams.set('utm_source', utm_source);
			url.searchParams.set('utm_medium', utm_medium);
			url.searchParams.set('utm_campaign', utm_campaign);
			return url.toString();
		}

		document.addEventListener('DOMContentLoaded', function () {
			var userAgent = navigator.userAgent || navigator.vendor || window.opera;
			var queryParams = getQueryParams();
			var playStoreLinkWithParams = buildPlayStoreLink(queryParams);

			if (/android/i.test(userAgent)) {
				// Redirect to Google Play Store link for Android
				window.location.href = playStoreLinkWithParams;
			} else if (/iPad|iPhone|iPod/.test(userAgent) && !window.MSStream) {
				// Redirect to Apple App Store link for iOS -> form for joining Closed Beta
				window.location.href = 'https://bit.ly/PaintFlags';
			} else {
				// Fallback for unsupported devices -> defaults to play store link
				window.location.href = playStoreLinkWithParams;
			}
		});
    </script>
</head>
<body>
</body>
</html>
